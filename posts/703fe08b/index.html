<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Yahya"><meta name="keywords" content=""><meta name="description" content="运行时数据区域  程序计数器程序计数器占用较小的内存空间，可以看做是当前线程所执行的字节码的行号指示器，由于Java虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，在任何一个确定的时刻，一个处理器（对于多核处理器来说就是一个内核）都只会执行一条线程中的指令。因此，为了线程切换后能够恢复到正确的执行位置，每条线程都需要有一个独立的程序计数器。 虚拟机栈虚拟机栈也是线程私有，而且生"><meta property="og:type" content="article"><meta property="og:title" content="JVM 运行时数据区域"><meta property="og:url" content="https://blog.yahyav2rayssr.top/posts/703fe08b/index.html"><meta property="og:site_name" content="yahya的博客"><meta property="og:description" content="运行时数据区域  程序计数器程序计数器占用较小的内存空间，可以看做是当前线程所执行的字节码的行号指示器，由于Java虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，在任何一个确定的时刻，一个处理器（对于多核处理器来说就是一个内核）都只会执行一条线程中的指令。因此，为了线程切换后能够恢复到正确的执行位置，每条线程都需要有一个独立的程序计数器。 虚拟机栈虚拟机栈也是线程私有，而且生"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/11.jpg"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/12.jpg"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/43.jpg"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/44.jpg"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/45.jpg"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913095535261.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913101857388.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/13.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200906225322365.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/14.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913102643892.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913104011024.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913103948183.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913113443514.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913113818910.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913114538933.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913115504641.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913120113450.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913121419831.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913153300105.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913110754925.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913111159080.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913111333013.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913112046793.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913112126073.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913112002946.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913112336880.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/image-20200913155025000.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/15.jpg"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/16.jpg"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/204.jpg"><meta property="article:published_time" content="2023-04-18T15:31:31.927Z"><meta property="article:modified_time" content="2023-04-18T15:31:31.928Z"><meta property="article:author" content="Yahya"><meta property="article:tag" content="JVM"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://blog.yahyav2rayssr.top/posts/703fe08b/11.jpg"><title>JVM 运行时数据区域 - yahya的博客</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"blog.yahyav2rayssr.top",root:"/",version:"1.9.4",typing:{enable:!1,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!1,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!1,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:6},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="yahya的博客" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Yahya的博客</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">JVM 运行时数据区域</span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-04-18 23:31" pubdate>2023年4月18日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 7.3k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 62 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Java" id="heading-d52387880e1ea22817a72d3759213819" role="tab" data-toggle="collapse" href="#collapse-d52387880e1ea22817a72d3759213819" aria-expanded="true">Java <span class="list-group-count">(61)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-d52387880e1ea22817a72d3759213819" role="tabpanel" aria-labelledby="heading-d52387880e1ea22817a72d3759213819"><div class="category-post-list"><a href="/posts/a3b6ed09/" title="Java 常用命令" class="list-group-item list-group-item-action"><span class="category-post">Java 常用命令</span></a></div><div class="category-sub row nomargin-x"><a class="category-subitem list-group-item category-item-action col-10 col-md-11 col-xm-11" title="JVM" id="heading-18b5a217c4dad25662d3a05edb0e39d7" role="tab" data-toggle="collapse" href="#collapse-18b5a217c4dad25662d3a05edb0e39d7" aria-expanded="true">JVM <span class="list-group-count">(6)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-18b5a217c4dad25662d3a05edb0e39d7" role="tabpanel" aria-labelledby="heading-18b5a217c4dad25662d3a05edb0e39d7"><div class="category-post-list"><a href="/posts/9e0bfe2e/" title="JVM 垃圾收集器" class="list-group-item list-group-item-action"><span class="category-post">JVM 垃圾收集器</span> </a><a href="/posts/5b44aded/" title="JVM 垃圾收集器与内存分配策略" class="list-group-item list-group-item-action"><span class="category-post">JVM 垃圾收集器与内存分配策略</span> </a><a href="/posts/62787a65/" title="JVM 基本概念" class="list-group-item list-group-item-action"><span class="category-post">JVM 基本概念</span> </a><a href="/posts/7c42c21b/" title="JVM 指令大全" class="list-group-item list-group-item-action"><span class="category-post">JVM 指令大全</span> </a><a href="/posts/1b362162/" title="JVM 杂项" class="list-group-item list-group-item-action"><span class="category-post">JVM 杂项</span> </a><a href="/posts/703fe08b/" title="JVM 运行时数据区域" class="list-group-item list-group-item-action active"><span class="category-post">JVM 运行时数据区域</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Java 基础" id="heading-3c457761d24c20abb3e9682a48e47df6" role="tab" data-toggle="collapse" href="#collapse-3c457761d24c20abb3e9682a48e47df6" aria-expanded="false">Java 基础 <span class="list-group-count">(6)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-3c457761d24c20abb3e9682a48e47df6" role="tabpanel" aria-labelledby="heading-3c457761d24c20abb3e9682a48e47df6"><div class="category-post-list"><a href="/posts/80d2509b/" title="Java IO 流详解" class="list-group-item list-group-item-action"><span class="category-post">Java IO 流详解</span> </a><a href="/posts/fa358471/" title="Java 反射" class="list-group-item list-group-item-action"><span class="category-post">Java 反射</span> </a><a href="/posts/a019e08c/" title="Java 基础" class="list-group-item list-group-item-action"><span class="category-post">Java 基础</span> </a><a href="/posts/74a86a53/" title="Java 数学运算" class="list-group-item list-group-item-action"><span class="category-post">Java 数学运算</span> </a><a href="/posts/23a29293/" title="Java 时间运算" class="list-group-item list-group-item-action"><span class="category-post">Java 时间运算</span> </a><a href="/posts/3aa3d5b8/" title="lambda 表达式用法" class="list-group-item list-group-item-action"><span class="category-post">lambda 表达式用法</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Spring" id="heading-38008dd81c2f4d7985ecf6e0ce8af1d1" role="tab" data-toggle="collapse" href="#collapse-38008dd81c2f4d7985ecf6e0ce8af1d1" aria-expanded="false">Spring <span class="list-group-count">(13)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-38008dd81c2f4d7985ecf6e0ce8af1d1" role="tabpanel" aria-labelledby="heading-38008dd81c2f4d7985ecf6e0ce8af1d1"><div class="category-post-list"><a href="/posts/2ed6c644/" title="Spring AOP 详解" class="list-group-item list-group-item-action"><span class="category-post">Spring AOP 详解</span> </a><a href="/posts/698a4e8e/" title="Spring Validation 校验" class="list-group-item list-group-item-action"><span class="category-post">Spring Validation 校验</span> </a><a href="/posts/df193b61/" title="Spring XML 配置详解" class="list-group-item list-group-item-action"><span class="category-post">Spring XML 配置详解</span> </a><a href="/posts/940ce4f5/" title="Spring 全局属性转换配置" class="list-group-item list-group-item-action"><span class="category-post">Spring 全局属性转换配置</span> </a><a href="/posts/fac11a47/" title="Spring 单元测试" class="list-group-item list-group-item-action"><span class="category-post">Spring 单元测试</span> </a><a href="/posts/f2bd63b2/" title="Spring 基本概念" class="list-group-item list-group-item-action"><span class="category-post">Spring 基本概念</span> </a><a href="/posts/4e9ceea/" title="Spring 基础" class="list-group-item list-group-item-action"><span class="category-post">Spring 基础</span> </a><a href="/posts/70a6ebcd/" title="Spring 常用注解" class="list-group-item list-group-item-action"><span class="category-post">Spring 常用注解</span> </a><a href="/posts/b230d5e5/" title="Spring 常用类" class="list-group-item list-group-item-action"><span class="category-post">Spring 常用类</span> </a><a href="/posts/7be9f3eb/" title="Spring 常见错误" class="list-group-item list-group-item-action"><span class="category-post">Spring 常见错误</span> </a><a href="/posts/b27a891c/" title="SpringCloud 组件概念" class="list-group-item list-group-item-action"><span class="category-post">SpringCloud 组件概念</span> </a><a href="/posts/2547f24d/" title="Springboot 启动流程" class="list-group-item list-group-item-action"><span class="category-post">Springboot 启动流程</span> </a><a href="/posts/fd57e58c/" title="Springboot 常用配置" class="list-group-item list-group-item-action"><span class="category-post">Springboot 常用配置</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="gradle" id="heading-8ed1a771bc236c287ad93c699bfdd2d7" role="tab" data-toggle="collapse" href="#collapse-8ed1a771bc236c287ad93c699bfdd2d7" aria-expanded="false">gradle <span class="list-group-count">(3)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-8ed1a771bc236c287ad93c699bfdd2d7" role="tabpanel" aria-labelledby="heading-8ed1a771bc236c287ad93c699bfdd2d7"><div class="category-post-list"><a href="/posts/884ca42/" title="Gradle 基础概念" class="list-group-item list-group-item-action"><span class="category-post">Gradle 基础概念</span> </a><a href="/posts/398308f9/" title="Gradle 安装配置" class="list-group-item list-group-item-action"><span class="category-post">Gradle 安装配置</span> </a><a href="/posts/62a229e/" title="Gradle 常用配置" class="list-group-item list-group-item-action"><span class="category-post">Gradle 常用配置</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="log" id="heading-dc1d71bbb5c4d2a5e936db79ef10c19f" role="tab" data-toggle="collapse" href="#collapse-dc1d71bbb5c4d2a5e936db79ef10c19f" aria-expanded="false">log <span class="list-group-count">(1)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-dc1d71bbb5c4d2a5e936db79ef10c19f" role="tabpanel" aria-labelledby="heading-dc1d71bbb5c4d2a5e936db79ef10c19f"><div class="category-post-list"><a href="/posts/a6ab95f3/" title="log 日志基本概念" class="list-group-item list-group-item-action"><span class="category-post">log 日志基本概念</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="maven" id="heading-402c5d9af6b43711ea070bee5170f74d" role="tab" data-toggle="collapse" href="#collapse-402c5d9af6b43711ea070bee5170f74d" aria-expanded="false">maven <span class="list-group-count">(7)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-402c5d9af6b43711ea070bee5170f74d" role="tabpanel" aria-labelledby="heading-402c5d9af6b43711ea070bee5170f74d"><div class="category-post-list"><a href="/posts/3a21973e/" title="Maven Archetype 使用" class="list-group-item list-group-item-action"><span class="category-post">Maven Archetype 使用</span> </a><a href="/posts/25549297/" title="Maven mvnw 详解" class="list-group-item list-group-item-action"><span class="category-post">Maven mvnw 详解</span> </a><a href="/posts/5c907e7a/" title="Maven 基本安装（windows）" class="list-group-item list-group-item-action"><span class="category-post">Maven 基本安装（windows）</span> </a><a href="/posts/6ff6dc3c/" title="Maven 基础概念" class="list-group-item list-group-item-action"><span class="category-post">Maven 基础概念</span> </a><a href="/posts/c718cdb9/" title="Maven 常用命令" class="list-group-item list-group-item-action"><span class="category-post">Maven 常用命令</span> </a><a href="/posts/615834e0/" title="Maven 常用配置" class="list-group-item list-group-item-action"><span class="category-post">Maven 常用配置</span> </a><a href="/posts/4f5fa1df/" title="Maven 常见问题" class="list-group-item list-group-item-action"><span class="category-post">Maven 常见问题</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="mybatis" id="heading-f0d71b77ac2ea991f39f9dfdd5e985b5" role="tab" data-toggle="collapse" href="#collapse-f0d71b77ac2ea991f39f9dfdd5e985b5" aria-expanded="false">mybatis <span class="list-group-count">(4)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-f0d71b77ac2ea991f39f9dfdd5e985b5" role="tabpanel" aria-labelledby="heading-f0d71b77ac2ea991f39f9dfdd5e985b5"><div class="category-post-list"><a href="/posts/f68be97c/" title="Mybatis XML 基础配置" class="list-group-item list-group-item-action"><span class="category-post">Mybatis XML 基础配置</span> </a><a href="/posts/2f2b0963/" title="Mybatis-plus XML 标签用法" class="list-group-item list-group-item-action"><span class="category-post">Mybatis-plus XML 标签用法</span> </a><a href="/posts/f384c0b1/" title="Mybatis-plus 代码用法" class="list-group-item list-group-item-action"><span class="category-post">Mybatis-plus 代码用法</span> </a><a href="/posts/3080fe57/" title="Mybatis-plus 基本配置" class="list-group-item list-group-item-action"><span class="category-post">Mybatis-plus 基本配置</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="多线程" id="heading-c9daf4ad6b1b7a1a3e1f2eb57d4d2fc7" role="tab" data-toggle="collapse" href="#collapse-c9daf4ad6b1b7a1a3e1f2eb57d4d2fc7" aria-expanded="false">多线程 <span class="list-group-count">(11)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-c9daf4ad6b1b7a1a3e1f2eb57d4d2fc7" role="tabpanel" aria-labelledby="heading-c9daf4ad6b1b7a1a3e1f2eb57d4d2fc7"><div class="category-post-list"><a href="/posts/9784837e/" title="AQS 原理" class="list-group-item list-group-item-action"><span class="category-post">AQS 原理</span> </a><a href="/posts/18ad812a/" title="CountDownLatch 应用" class="list-group-item list-group-item-action"><span class="category-post">CountDownLatch 应用</span> </a><a href="/posts/27d2027c/" title="CyclicBarrier 应用" class="list-group-item list-group-item-action"><span class="category-post">CyclicBarrier 应用</span> </a><a href="/posts/e5b78a2e/" title="Java 多线程入门" class="list-group-item list-group-item-action"><span class="category-post">Java 多线程入门</span> </a><a href="/posts/71aa5641/" title="Java 多线程基础" class="list-group-item list-group-item-action"><span class="category-post">Java 多线程基础</span> </a><a href="/posts/ff94c717/" title="Java 多线程基础集合体系概述" class="list-group-item list-group-item-action"><span class="category-post">Java 多线程基础集合体系概述</span> </a><a href="/posts/7c5551ea/" title="Java 多线程常用 API" class="list-group-item list-group-item-action"><span class="category-post">Java 多线程常用 API</span> </a><a href="/posts/4b405cfc/" title="Java 多线程设计模式" class="list-group-item list-group-item-action"><span class="category-post">Java 多线程设计模式</span> </a><a href="/posts/cf2a801/" title="Java 线程池详解" class="list-group-item list-group-item-action"><span class="category-post">Java 线程池详解</span> </a><a href="/posts/bcd2abf0/" title="Semaphore 应用" class="list-group-item list-group-item-action"><span class="category-post">Semaphore 应用</span> </a><a href="/posts/61ccd33e/" title="StampedLock 应用" class="list-group-item list-group-item-action"><span class="category-post">StampedLock 应用</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="工具库" id="heading-de33723f9f63fa412b6071def21565ce" role="tab" data-toggle="collapse" href="#collapse-de33723f9f63fa412b6071def21565ce" aria-expanded="false">工具库 <span class="list-group-count">(5)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-de33723f9f63fa412b6071def21565ce" role="tabpanel" aria-labelledby="heading-de33723f9f63fa412b6071def21565ce"><div class="category-post-list"><a href="/posts/86e940c9/" title="fastjson 常用 API" class="list-group-item list-group-item-action"><span class="category-post">fastjson 常用 API</span> </a><a href="/posts/4e9562ed/" title="fastjson 常见问题" class="list-group-item list-group-item-action"><span class="category-post">fastjson 常见问题</span> </a><a href="/posts/df564e8b/" title="lombok 基础" class="list-group-item list-group-item-action"><span class="category-post">lombok 基础</span> </a><a href="/posts/34954977/" title="swagger 常用注解" class="list-group-item list-group-item-action"><span class="category-post">swagger 常用注解</span> </a><a href="/posts/f5eac37d/" title="工具库杂项" class="list-group-item list-group-item-action"><span class="category-post">工具库杂项</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="数据结构" id="heading-0fea7c47d93da5689f31820ee525b367" role="tab" data-toggle="collapse" href="#collapse-0fea7c47d93da5689f31820ee525b367" aria-expanded="false">数据结构 <span class="list-group-count">(3)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-0fea7c47d93da5689f31820ee525b367" role="tabpanel" aria-labelledby="heading-0fea7c47d93da5689f31820ee525b367"><div class="category-post-list"><a href="/posts/39a12d12/" title="ConcurrentHashMap 详解" class="list-group-item list-group-item-action"><span class="category-post">ConcurrentHashMap 详解</span> </a><a href="/posts/e344884c/" title="HashMap 详解" class="list-group-item list-group-item-action"><span class="category-post">HashMap 详解</span> </a><a href="/posts/c9844e82/" title="Java 数据结构基础" class="list-group-item list-group-item-action"><span class="category-post">Java 数据结构基础</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="设计模式" id="heading-301a19970448f8e4f27ddae7a7d415fe" role="tab" data-toggle="collapse" href="#collapse-301a19970448f8e4f27ddae7a7d415fe" aria-expanded="false">设计模式 <span class="list-group-count">(1)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-301a19970448f8e4f27ddae7a7d415fe" role="tabpanel" aria-labelledby="heading-301a19970448f8e4f27ddae7a7d415fe"><div class="category-post-list"><a href="/posts/fa3d1251/" title="Java 设计模式" class="list-group-item list-group-item-action"><span class="category-post">Java 设计模式</span></a></div></div></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">JVM 运行时数据区域</h1><p class="note note-info">本文最后更新于：2023年4月18日 晚上</p><div class="markdown-body"><h1 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h1><img src="/posts/703fe08b/11.jpg" srcset="/img/loading.gif" lazyload><h2 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h2><p>程序计数器占用较小的内存空间，可以看做是<strong>当前线程所执行的字节码的行号指示器</strong>，由于Java虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，在任何一个确定的时刻，一个处理器（对于多核处理器来说就是一个内核）都只会执行一条线程中的指令。因此，<strong>为了线程切换后能够恢复到正确的执行位置</strong>，每条线程都需要有一个独立的程序计数器。</p><h2 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h2><p>虚拟机栈也是线程私有，而且生命周期与线程相同，每个Java方法在执行的时候都会创建一个栈帧（Stack Frame）用于存储<strong>局部变量表、操作数栈、动态链接、方法出口</strong>等信息。</p><ul><li>局部变量表：存放了编译器可知的<strong>各种基本数据类型</strong>（boolean、byte等）、<strong>对象引用</strong>（reference类型，它不等同于对象本身，可能是一个指向对象起始地址的引用指针，也可能是指向另一个代表对象的句柄或其他次对象相关的位置）和<strong>returnAddress类型</strong>（指向了一条字节码指令的地址）</li></ul><img src="/posts/703fe08b/12.jpg" srcset="/img/loading.gif" lazyload><h2 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h2><p>本地方法占（Native Method Stacks）与虚拟机栈所发挥的作用是非常相似的，其区别只是<strong>虚拟机栈为虚拟机执行Java方法（也就是字节码）服务，而本地方法栈则是为虚拟机使用到的本地（Native）方法服务</strong>。</p><h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p><strong>Java堆（Java Heap）的唯一目的就是存放对象实例</strong>，Java世界里“几乎”所有的对象实例都在这里分配内存。</p><h2 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h2><p>方法区（Method Area）Java堆一样，是各个线程共享的内存区域，用于<strong>存储已被虚拟机加载的类型信息、常量（final）、静态变量、即时编译器编译后的代码等数据</strong>；别名叫做“非堆”（Non-Heap），目的是与Java堆区分开来。</p><blockquote><p>JDK8中完全废弃了永久代的概念，改用在本地内存中实现的元空间（Meta-space）来代替，把JDK7中永久代剩余的内容（主要是类型信息）全部移到元空间中。</p></blockquote><p>方法区的内存回收目标主要是针对<strong>常量池的回收和对类型的卸载</strong>（此部分比较苛刻）。</p><h3 id="运行时常量池"><a href="#运行时常量池" class="headerlink" title="运行时常量池"></a>运行时常量池</h3><p>运行时常量池（Running Constant Pool）是方法区的一部分；运行时常量池相对于Class文件常量池的另外一个重要特性是<strong>动态性</strong>，Java语言并不要求常量一定只有编译期才能产生，也就是说，并非预置入Class文件中常量池的内容才能进入方法区运行时常量池，运行期间也可以将新的常量放入池中，这种特性本开发人员用得比较多的便是String类的intern()方法。</p><p><strong>JDK1.7之后被移动到堆中了。</strong></p><img src="/posts/703fe08b/43.jpg" srcset="/img/loading.gif" lazyload><h4 id="intern方法详解"><a href="#intern方法详解" class="headerlink" title="intern方法详解"></a>intern方法详解</h4><p>String.intern()是一个Native(本地)方法，它的作用是如果<strong>字符串常量池已经包含一个等于此String对象的字符串，则返回字符串常量池中这个字符串的引用</strong>, <strong>否则将当前String对象的引用地址（堆中）添加到字符串常量池中并返回</strong>。</p><blockquote><p>由于intern(）操作每次都需要与常量池中的数据进行比较以查看常量池中是否存在等值数据，同时JVM需要确保常量池中的数据的唯一性，这就涉及到加锁机制，这些操作都是有需要占用CPU时间的，所以如果进行intern操作的是大量不会被重复利用的String的话，则有点得不偿失。由此可见，String.intern()主要 <strong>适用于只有有限值，并且这些有限值会被重复利用的场景</strong>，如：数据库表中的列名、人的姓氏、编码类型等。</p></blockquote><p>示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      	<span class="hljs-comment">// 1： 首先会在Heap中创建对象，然后在常量池中放入zhagnsan 和 wangwu ，但是并不会放入zhagnsanwangwu</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>) + <span class="hljs-string">&quot;wangwu&quot;</span>;<br>      	<span class="hljs-comment">// 2：调用 intern ，因为字符串常量池中没有”zhangsanwangwu”这种拼接后的字符串，所以将堆中String对象的引用地址添加到字符串常量池中。jdk1.7后常量池引入到了Heap中，所以可以直接存储引用</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> a.intern();<br>      	<span class="hljs-comment">// 3：因为 a 的地址和 b的地址一致，所以是true</span><br>        System.out.println(a == b);<br>      <br>      	<span class="hljs-comment">// 4：因常量池中已经存在 zhangsanwangwu 了，所以直接返回引用就是 a 类型 a ==b 锁 a==b==c</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;zhangsanwangwu&quot;</span>;<br>        System.out.println(a == c); <span class="hljs-comment">// true</span><br>      	System.out.println(b == c); <span class="hljs-comment">// true</span><br>      <br>      	<span class="hljs-comment">// 5：首先会在Heap中创建对象，然后会在常量池中存储 zhang 和 san</span><br>      	<span class="hljs-type">String</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;zhang&quot;</span>) + <span class="hljs-string">&quot;san&quot;</span>;<br>      	<span class="hljs-comment">// 6： 返回的是 常量池中的 地址，因在a变量时已经将 zhangsan 放入到了常量池中</span><br>      	<span class="hljs-type">String</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> d.intern();<br>      	System.out.println(d == f); <span class="hljs-comment">// false</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Class文件常量池"><a href="#Class文件常量池" class="headerlink" title="Class文件常量池"></a>Class文件常量池</h4><p>Class文件常量池，用于存放编译期生成的各种<strong>字面量和符号引用</strong>，这部分内容将在类加载后进入方法区的运行时常量池中存放。运行时常量池中主要存放两大类常量：<strong>字面量和符号引用。当Class文件常量池加载到方法区时，会把符号引用转换为直接引用，存放到运行时常量池。</strong></p><img src="/posts/703fe08b/44.jpg" srcset="/img/loading.gif" lazyload> <img src="/posts/703fe08b/45.jpg" srcset="/img/loading.gif" lazyload><blockquote><p>除了字符串常量池，8种基本数据类型中除了两种浮点类型剩余的6种基本数据类型的包装类，都使用了缓冲池技术，但是 <code>Byte</code>、<code>Short</code>、<code>Integer</code>、<code>Long</code>、<code>Character</code> 这5种整型的包装类也只是在对应值在 [-128,127] 时才会使用缓冲池，超出此范围仍然会去创建新的对象。</p></blockquote><h2 id="直接内存"><a href="#直接内存" class="headerlink" title="直接内存"></a>直接内存</h2><p>NIO（New Input&#x2F;Output）类是一种引入了一种基于通道（Channel）与缓冲区（Buffer）的I&#x2F;O方式的操作类，它可以使用Native函数库直接分配堆外内存，然后通过一个存储在Java堆里面的DirectByteBuffer对象作为这块内存的引用进行操作。这样能在一些场景中显著提高性能，因为避免了在Java堆和Native堆中来回复制数据。</p><h1 id="对象的创建"><a href="#对象的创建" class="headerlink" title="对象的创建"></a>对象的创建</h1><p>当Java虚拟机遇到一条字节码new指令时，首先将去检查这个指令的参数是否能在常量池中定位到一个类的符号引用，并且检查这个符号引用代表的类是否已被加载、解析和初始化过。如果没有，那必须先执行相应的类加载过程，在类加载检查通过后，接下来虚拟机将为新生对象分配内存。对象所需内存大小在类加载完成之后便可完全确定，为对象分配内存的任务实际上便等同于把一块确定大小的内存块从Java堆中划分出来。</p><h2 id="内存分配方式"><a href="#内存分配方式" class="headerlink" title="内存分配方式"></a>内存分配方式</h2><h3 id="指针碰撞"><a href="#指针碰撞" class="headerlink" title="指针碰撞"></a>指针碰撞</h3><p>假设Java堆中内存是绝对规整的，所有被使用过的内存都被放在一边，空间的内存被放在另一边，中间放着一个指针作为分界点的指示器，那所分配内存仅仅是把那个指针向空闲方向挪动一段与对象大小相等的距离，这种分配方式叫做<strong>指针碰撞</strong>（Bump the barrier）。</p><h3 id="空闲列表"><a href="#空闲列表" class="headerlink" title="空闲列表"></a>空闲列表</h3><p>但如果Java堆中的内存并不是规整的，虚拟机就必须维护一个列表，记录上那些内存块是可用的，在分配的时候从列表中找到一块足够大的空间划分给对象实例，并更新记录上的记录，这种分配方式成为<strong>空闲列表</strong>。</p><blockquote><p>实际上使用哪种内存分配方式由Java堆是否规整决定，而Java堆是否规整又由所采用的垃圾收集器<strong>是否带有空间压缩整理（Compact）的能力</strong>决定。因此，当使用Serial，ParNew等带压缩整理过程的收集器时，系统采用的分配算法是指针碰撞，既简单又高效；而当使用CMS这种基于清除（Sweep）算法的收集器时，<strong>理论上</strong>就只能采用较为复杂的空闲列表来分配内存。</p><p>虚拟机是采用CAS配上失败重试的方法保证更新操作的原子性；另外一种是把内存分配的动作按照线程划分在不同的空间之中进行，即每个线程在Java堆中预先分配一小块内存，称为<strong>本地线程分配缓冲区</strong>（Thread Local Allocation Buffer，TLAB），哪个线程要分配内存，就在哪个线程的本地缓冲区中分配内存，只有本地缓冲区用完了，分配新的缓存区时才需要同步锁定。虚拟机是否使用TLAB，可以通过<code>-XX:+/-UseTLAB</code>参数来设定。</p></blockquote><h1 id="对象的内存布局"><a href="#对象的内存布局" class="headerlink" title="对象的内存布局"></a>对象的内存布局</h1><img src="/posts/703fe08b/image-20200913095535261.png" srcset="/img/loading.gif" lazyload alt="image-20200913095535261"> <img src="/posts/703fe08b/image-20200913101857388.png" srcset="/img/loading.gif" lazyload alt="image-20200913101857388"><p>对象在堆内存中的存储布局可以划分为三个部分：<strong>对象头</strong>（Header），<strong>实例数据</strong>（Instance Data）和<strong>对齐填充</strong>（Padding）。</p><p><strong>内存布局图</strong>：</p><img src="/posts/703fe08b/13.png" srcset="/img/loading.gif" lazyload><h2 id="对象头"><a href="#对象头" class="headerlink" title="对象头"></a>对象头</h2><p>HotSpot虚拟机的<strong>对象头</strong>包括两部分信息，第一部分是<strong>“Mark Word</strong>”，用于存储对象自身的运行时数据， 如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等等。</p><h3 id="Mark-Word"><a href="#Mark-Word" class="headerlink" title="Mark Word"></a>Mark Word</h3><p>Mark Word记录了对象和锁有关的信息，当这个对象被synchronized关键字当成同步锁时，围绕这个锁的一系列操作都和Mark Word有关。</p><p>Mark Word在32位JVM中的长度是32bit，在64位JVM中长度是64bit。</p><p>Mark Word在不同的锁状态下存储的内容不同，在32位JVM中是这么存的：</p><img src="/posts/703fe08b/image-20200906225322365.png" srcset="/img/loading.gif" lazyload alt="image-20200906225322365"><table><thead><tr><th><strong>存储内容</strong></th><th><strong>标志位</strong></th><th><strong>状态</strong></th></tr></thead><tbody><tr><td>对象哈希码、对象分代年龄</td><td>01</td><td>未锁定</td></tr><tr><td>指向锁记录的指针</td><td>00</td><td>轻量级锁定</td></tr><tr><td>指向重量级锁的指针</td><td>10</td><td>膨胀（重量级锁定）</td></tr><tr><td>空，不需要记录信息</td><td>11</td><td>GC标记</td></tr><tr><td>偏向线程ID、偏向时间戳、对象分代年龄<br>偏向锁线程ID、epoch、对象分代年龄、偏向锁标识</td><td>01</td><td>可偏向</td></tr></tbody></table><img src="/posts/703fe08b/14.png" srcset="/img/loading.gif" lazyload><h4 id="重量级锁-Monitor"><a href="#重量级锁-Monitor" class="headerlink" title="重量级锁-Monitor"></a>重量级锁-Monitor</h4><p>Mark Word 状态取决于 Monitor 锁，Monitor 锁必须加 synchronized 锁才会生效</p><img src="/posts/703fe08b/image-20200913102643892.png" srcset="/img/loading.gif" lazyload alt="image-20200913102643892" style="zoom:33%"><p>例子：</p><blockquote><p>synchronized 通过一个 lock 引用 找到 monitor 对象来操控 Mark Word 头里面的内容。</p></blockquote><img src="/posts/703fe08b/image-20200913104011024.png" srcset="/img/loading.gif" lazyload alt="image-20200913104011024" style="zoom:33%"> <img src="/posts/703fe08b/image-20200913103948183.png" srcset="/img/loading.gif" lazyload alt="image-20200913103948183" style="zoom:33%"><h4 id="锁升级"><a href="#锁升级" class="headerlink" title="锁升级"></a>锁升级</h4><h5 id="偏向锁"><a href="#偏向锁" class="headerlink" title="偏向锁"></a>偏向锁</h5><img src="/posts/703fe08b/image-20200913113443514.png" srcset="/img/loading.gif" lazyload alt="image-20200913113443514" style="zoom:50%"><h6 id="偏向状态"><a href="#偏向状态" class="headerlink" title="偏向状态"></a>偏向状态</h6><img src="/posts/703fe08b/image-20200913113818910.png" srcset="/img/loading.gif" lazyload alt="image-20200913113818910" style="zoom:50%"> <img src="/posts/703fe08b/image-20200913114538933.png" srcset="/img/loading.gif" lazyload alt="image-20200913114538933" style="zoom:50%"> <img src="/posts/703fe08b/image-20200913115504641.png" srcset="/img/loading.gif" lazyload alt="image-20200913115504641" style="zoom:50%"><h6 id="撤销-调用对象的-HashCode"><a href="#撤销-调用对象的-HashCode" class="headerlink" title="撤销-调用对象的 HashCode"></a>撤销-调用对象的 HashCode</h6><img src="/posts/703fe08b/image-20200913120113450.png" srcset="/img/loading.gif" lazyload alt="image-20200913120113450" style="zoom:50%"><h6 id="撤销-其他线程使用对象"><a href="#撤销-其他线程使用对象" class="headerlink" title="撤销-其他线程使用对象"></a>撤销-其他线程使用对象</h6><h6 id="撤销-调用wait-x2F-notify"><a href="#撤销-调用wait-x2F-notify" class="headerlink" title="撤销-调用wait&#x2F;notify"></a>撤销-调用wait&#x2F;notify</h6><h6 id="批量重偏向"><a href="#批量重偏向" class="headerlink" title="批量重偏向"></a>批量重偏向</h6><img src="/posts/703fe08b/image-20200913121419831.png" srcset="/img/loading.gif" lazyload alt="image-20200913121419831" style="zoom:50%"><h6 id="批量撤销"><a href="#批量撤销" class="headerlink" title="批量撤销"></a>批量撤销</h6><img src="/posts/703fe08b/image-20200913153300105.png" srcset="/img/loading.gif" lazyload alt="image-20200913153300105" style="zoom:50%"><h5 id="轻量级锁"><a href="#轻量级锁" class="headerlink" title="轻量级锁"></a>轻量级锁</h5><blockquote><p>信息存储在当前线程的栈帧里的锁记录（Lock Record）里面。</p></blockquote><h6 id="加锁流程"><a href="#加锁流程" class="headerlink" title="加锁流程"></a>加锁流程</h6><img src="/posts/703fe08b/image-20200913110754925.png" srcset="/img/loading.gif" lazyload alt="image-20200913110754925"> <img src="/posts/703fe08b/image-20200913111159080.png" srcset="/img/loading.gif" lazyload alt="image-20200913111159080" style="zoom:50%"><h6 id="解锁流程"><a href="#解锁流程" class="headerlink" title="解锁流程"></a>解锁流程</h6><img src="/posts/703fe08b/image-20200913111333013.png" srcset="/img/loading.gif" lazyload alt="image-20200913111333013" style="zoom:50%"><h5 id="锁膨胀"><a href="#锁膨胀" class="headerlink" title="锁膨胀"></a>锁膨胀</h5><img src="/posts/703fe08b/image-20200913112046793.png" srcset="/img/loading.gif" lazyload alt="image-20200913112046793" style="zoom:50%"> <img src="/posts/703fe08b/image-20200913112126073.png" srcset="/img/loading.gif" lazyload alt="image-20200913112126073"> <img src="/posts/703fe08b/image-20200913112002946.png" srcset="/img/loading.gif" lazyload alt="image-20200913112002946"><h5 id="自旋优化"><a href="#自旋优化" class="headerlink" title="自旋优化"></a>自旋优化</h5><img src="/posts/703fe08b/image-20200913112336880.png" srcset="/img/loading.gif" lazyload alt="image-20200913112336880"><h5 id="锁消除"><a href="#锁消除" class="headerlink" title="锁消除"></a>锁消除</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Fork(1)</span><br><span class="hljs-meta">@BenchmarkMode(Mode.AverageTime)</span><br><span class="hljs-comment">// 预热次数</span><br><span class="hljs-meta">@Warmup(iterations=3)</span><br><span class="hljs-comment">// 测试次数</span><br><span class="hljs-meta">@Measurement(iterations=5)</span><br><span class="hljs-meta">@OutputTimeUnit(TimeUnit.NANOSECONDS)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBenchmark</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-meta">@Benchmark</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">a</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        x++;<br>    &#125;<br>    <span class="hljs-meta">@Benchmark</span><br>    <span class="hljs-comment">// JIT  即时编译器</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">b</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>        <span class="hljs-keyword">synchronized</span> (o) &#123;<br>            x++;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>结果：</p><p>默认开启优化，可用<code>-XX:-EliminateLocks</code>禁用</p><img src="/posts/703fe08b/image-20200913155025000.png" srcset="/img/loading.gif" lazyload alt="image-20200913155025000"><h3 id="类型指针"><a href="#类型指针" class="headerlink" title="类型指针"></a>类型指针</h3><p>对象头的另一部分是类型指针，即对象指向它的类型元数据的指针，Java虚拟机通过这个指针来确定该对象是哪个类的实例。</p><h2 id="实例数据"><a href="#实例数据" class="headerlink" title="实例数据"></a>实例数据</h2><p>实例数据是对象真正存储的有效信息，即我们在程序代码里面所以定义的各种类型的字段内容。</p><blockquote><ul><li><p>-XX:FieldsAllocationStyle</p><p>实例数据的字段的存储顺序受此参数影响，相同宽度的字段总是被分配到一起存放。</p><p>HotSpot虚拟机默认的分配顺序为longs&#x2F;doubles、ints、shorts&#x2F;chars、bytes&#x2F;booleans、oops（Ordinary Object Pointers）</p></li><li><p>+XX:CompactFields</p><p>子类之中较窄的变量也允许插入父类变量的空隙之中，以节省出一点点空间，默认为true即启用。</p></li></ul></blockquote><h2 id="对齐填充"><a href="#对齐填充" class="headerlink" title="对齐填充"></a>对齐填充</h2><p>对齐填充并不是必然存在的，也没有特别的含义，它仅仅起着占位符的作用。由于HotSpot VM的自动内存管理系统要求<strong>对象起始地址必须是8字节的整数倍</strong>，换句话说就是对象的大小必须是8字节的整数倍。对象头正好是8字节的倍数（1倍或者2倍），因此当对象实例数据部分没有对齐的话，就需要通过对齐填充来补全。</p><h1 id="对象的访问定位"><a href="#对象的访问定位" class="headerlink" title="对象的访问定位"></a>对象的访问定位</h1><p>对象的访问定位主要有句柄和直接指针两种。</p><h2 id="句柄"><a href="#句柄" class="headerlink" title="句柄"></a>句柄</h2><blockquote><p>使用句柄访问的最好好处就是reference中存储的是稳定句柄地址，在对象移动时只会改变句柄中的实例数据指针，而reference本身不需要被修改。</p></blockquote><p>如果使用句柄访问的话，reference中存储的就是对象的句柄地址，而句柄中包含了对象实例数据与类型数据各自具体的地址信息。</p><img src="/posts/703fe08b/15.jpg" srcset="/img/loading.gif" lazyload><h2 id="直接指针"><a href="#直接指针" class="headerlink" title="直接指针"></a>直接指针</h2><p>速度快，节省了一次指针定位的时间开销。HotSpot采用此方式</p><img src="/posts/703fe08b/16.jpg" srcset="/img/loading.gif" lazyload><h1 id="类加载机制"><a href="#类加载机制" class="headerlink" title="类加载机制"></a>类加载机制</h1><h2 id="直接引用和符号引用"><a href="#直接引用和符号引用" class="headerlink" title="直接引用和符号引用"></a>直接引用和符号引用</h2><p>1.符号引用（Symbolic References）：</p><p>　　符号引用以一组符号来描述所引用的目标，符号可以是任何形式的字面量，只要使用时能够无歧义的定位到目标即可。例如，在Class文件中它以CONSTANT_Class_info、CONSTANT_Fieldref_info、CONSTANT_Methodref_info等类型的常量出现。符号引用与虚拟机的内存布局无关，引用的目标并不一定加载到内存中。在<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/javaee">Java</a>中，一个java类将会编译成一个class文件。在编译时，java类并不知道所引用的类的实际地址，因此只能使用符号引用来代替。比如org.simple.People类引用了org.simple.Language类，在编译时People类并不知道Language类的实际内存地址，因此只能使用符号org.simple.Language（假设是这个，当然实际中是由类似于CONSTANT_Class_info的常量来表示的）来表示Language类的地址。各种虚拟机实现的内存布局可能有所不同，但是它们能接受的符号引用都是一致的，因为符号引用的字面量形式明确定义在Java虚拟机规范的Class文件格式中。</p><p>2.直接引用：</p><p>直接引用可以是</p><p>（1）直接指向目标的指针（比如，指向“类型”【Class对象】、类变量、类方法的直接引用可能是指向方法区的指针）</p><p>（2）相对偏移量（比如，指向实例变量、实例方法的直接引用都是偏移量）</p><p>（3）一个能间接定位到目标的句柄</p><p>直接引用是和虚拟机的布局相关的，同一个符号引用在不同的虚拟机实例上翻译出来的直接引用一般不会相同。如果有了直接引用，那引用的目标必定已经被加载入内存中了。</p><h2 id="类加载过程"><a href="#类加载过程" class="headerlink" title="类加载过程"></a>类加载过程</h2><img src="/posts/703fe08b/204.jpg" srcset="/img/loading.gif" lazyload><p>其中，加载、验证、准备、初始化、卸载的<strong>开始顺序</strong>是确定的，注意，只是按顺序开始，进行与结束的顺序并不一定。解析阶段可能在初始化之后开始。</p><p>一、类的加载</p><p>我们平常说的加载大多不是指的类加载机制，只是类加载机制中的第一步加载。在这个阶段，JVM主要完成三件事：</p><p>1、通过一个类的全限定名（包名与类名）来获取定义此类的二进制字节流（Class文件）。而获取的方式，可以通过jar包、war包、网络中获取、JSP文件生成等方式。</p><p>2、将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。这里只是转化了数据结构，并未合并数据。（方法区就是用来存放已被加载的类信息，常量，静态变量，编译后的代码的运行时内存区域）</p><p>3、在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口。这个Class对象并没有规定是在Java堆内存中，它比较特殊，虽为对象，但存放在方法区中。</p><p>二、类的连接</p><p>类的加载过程后生成了类的 java.lang.Class 对象，接着会进入连接阶段，连接阶段负责将类的二进制数据合并入JRE（Java运行时环境）中。类的连接大致分三个阶段。</p><p><em><strong>1、验证：</strong></em>验证被加载后的类是否有正确的结构，类数据是否会符合虚拟机的要求，确保不会危害虚拟机安全。</p><p><em><strong>2、准备：</strong></em>为类的静态变量（static filed）在方法区分配内存，并赋默认初值（0值或null值）。如static int a &#x3D; 100;</p><p>静态变量a就会在准备阶段被赋默认值0。</p><p>对于一般的成员变量是在类实例化时候，随对象一起分配在堆内存中。</p><p>另外，静态常量（static final filed）会在准备阶段赋程序设定的初值，如static final int a &#x3D; 666; 静态常量a就会在准备阶段被直接赋值为666，对于静态变量，这个操作是在初始化阶段进行的。</p><p><em><strong>3、解析：</strong></em>将类的二进制数据中的符号引用换为直接引用。</p><p>三、类的初始化</p><p>类初始化是类加载的最后一步，除了加载阶段，用户可以通过自定义的类加载器参与，其他阶段都完全由虚拟机主导和控制。到了初始化阶段才真正执行Java代码。</p><p>****类的初始化的主要工作****是为静态变量赋程序设定的初值。</p><p>如static int a &#x3D; 100;在准备阶段，a被赋默认值0，在初始化阶段就会被赋值为100。</p><p>Java虚拟机规范中严格规定了****有且只有五种情况必须对类进行初始化****：</p><p>1、使用new字节码指令创建类的实例，或者使用getstatic、putstatic读取或设置一个静态字段的值（放入常量池中的常量除外），或者调用一个静态方法的时候，对应类必须进行过初始化。</p><p>2、通过java.lang.reflect包的方法对类进行反射调用的时候，如果类没有进行过初始化，则要首先进行初始化。</p><p>3、当初始化一个类的时候，如果发现其父类没有进行过初始化，则首先触发父类初始化。</p><p>4、当虚拟机启动时，用户需要指定一个主类（包含main()方法的类），虚拟机会首先初始化这个类。</p><p>5、使用jdk1.7的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果REF_getStatic、REF_putStatic、RE_invokeStatic的方法句柄，并且这个方法句柄对应的类没有进行初始化，则需要先触发其初始化。</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Java/" class="category-chain-item">Java</a> <span>></span> <a href="/categories/Java/JVM/" class="category-chain-item">JVM</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/JVM/">#JVM</a></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/posts/c375a1af/" title="研发文档规范"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">研发文档规范</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/aa794d6f/" title="kubernete 详解"><span class="hidden-mobile">kubernete 详解</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"></div></footer><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>