<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Yahya"><meta name="keywords" content=""><meta name="description" content="explain解析+—-+————-+——-+————+——+—————+——+———+——+——–+———-+——-+ | id   | select_type  | table  | partitions   |  type | possible_keys | key    | key_len  | ref    | rows     | filtered    | Extra  |+—-+—"><meta property="og:type" content="article"><meta property="og:title" content="MySQL 基础"><meta property="og:url" content="https://blog.yahyav2rayssr.top/posts/47eac6e4/index.html"><meta property="og:site_name" content="yahya的博客"><meta property="og:description" content="explain解析+—-+————-+——-+————+——+—————+——+———+——+——–+———-+——-+ | id   | select_type  | table  | partitions   |  type | possible_keys | key    | key_len  | ref    | rows     | filtered    | Extra  |+—-+—"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/47eac6e4/39e54196f2ef05825d5c1acc5a011b9e1603852427033.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/47eac6e4/d859318270b849fea74d1a307aea246ftplv-k3u1fbpfcp-zoom-1.image"><meta property="article:published_time" content="2023-04-18T15:31:25.593Z"><meta property="article:modified_time" content="2023-04-18T15:31:25.594Z"><meta property="article:author" content="Yahya"><meta property="article:tag" content="MySQL"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://blog.yahyav2rayssr.top/posts/47eac6e4/39e54196f2ef05825d5c1acc5a011b9e1603852427033.png"><title>MySQL 基础 - yahya的博客</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"blog.yahyav2rayssr.top",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!1,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!1,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:6},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="yahya的博客" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Yahya的博客</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="MySQL 基础"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-04-18 23:31" pubdate>2023年4月18日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 7.1k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 60 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="中间件" id="heading-3cbfec336978067fe5295fb69a0ca202" role="tab" data-toggle="collapse" href="#collapse-3cbfec336978067fe5295fb69a0ca202" aria-expanded="true">中间件 <span class="list-group-count">(10)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-3cbfec336978067fe5295fb69a0ca202" role="tabpanel" aria-labelledby="heading-3cbfec336978067fe5295fb69a0ca202"><div class="category-post-list"></div><div class="category-sub row nomargin-x"><a class="category-subitem list-group-item category-item-action col-10 col-md-11 col-xm-11" title="MySQL" id="heading-62a004b95946bb97541afa471dcca73a" role="tab" data-toggle="collapse" href="#collapse-62a004b95946bb97541afa471dcca73a" aria-expanded="true">MySQL <span class="list-group-count">(7)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-62a004b95946bb97541afa471dcca73a" role="tabpanel" aria-labelledby="heading-62a004b95946bb97541afa471dcca73a"><div class="category-post-list"><a href="/posts/47eac6e4/" title="MySQL 基础" class="list-group-item list-group-item-action active"><span class="category-post">MySQL 基础</span> </a><a href="/posts/b2e36861/" title="MySQL 常用 SQL" class="list-group-item list-group-item-action"><span class="category-post">MySQL 常用 SQL</span> </a><a href="/posts/31eec5f6/" title="MySQL 常用命令" class="list-group-item list-group-item-action"><span class="category-post">MySQL 常用命令</span> </a><a href="/posts/3aad583d/" title="MySQL 时区问题" class="list-group-item list-group-item-action"><span class="category-post">MySQL 时区问题</span> </a><a href="/posts/8c2abb3e/" title="MySQL 时间基本概念" class="list-group-item list-group-item-action"><span class="category-post">MySQL 时间基本概念</span> </a><a href="/posts/18ea587c/" title="MySQL 时间数据类型对照表" class="list-group-item list-group-item-action"><span class="category-post">MySQL 时间数据类型对照表</span> </a><a href="/posts/c24675b4/" title="MySQL 索引" class="list-group-item list-group-item-action"><span class="category-post">MySQL 索引</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Redis" id="heading-e111446745a1825b862f8727ae63bce4" role="tab" data-toggle="collapse" href="#collapse-e111446745a1825b862f8727ae63bce4" aria-expanded="false">Redis <span class="list-group-count">(2)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-e111446745a1825b862f8727ae63bce4" role="tabpanel" aria-labelledby="heading-e111446745a1825b862f8727ae63bce4"><div class="category-post-list"><a href="/posts/17835f44/" title="Redis 三种集群架构" class="list-group-item list-group-item-action"><span class="category-post">Redis 三种集群架构</span> </a><a href="/posts/99f6ec28/" title="Redis 常用命令" class="list-group-item list-group-item-action"><span class="category-post">Redis 常用命令</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="消息队列" id="heading-8bedb7aae7ae74964d0363a1556c7a59" role="tab" data-toggle="collapse" href="#collapse-8bedb7aae7ae74964d0363a1556c7a59" aria-expanded="false">消息队列 <span class="list-group-count">(1)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-8bedb7aae7ae74964d0363a1556c7a59" role="tabpanel" aria-labelledby="heading-8bedb7aae7ae74964d0363a1556c7a59"><div class="category-post-list"></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="RabbitMQ" id="heading-7eaa993723e57b3bfc99923c196e2e17" role="tab" data-toggle="collapse" href="#collapse-7eaa993723e57b3bfc99923c196e2e17" aria-expanded="false">RabbitMQ <span class="list-group-count">(1)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-7eaa993723e57b3bfc99923c196e2e17" role="tabpanel" aria-labelledby="heading-7eaa993723e57b3bfc99923c196e2e17"><div class="category-post-list"><a href="/posts/8e078847/" title="RabbitMQ 详解" class="list-group-item list-group-item-action"><span class="category-post">RabbitMQ 详解</span></a></div></div></div></div></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">MySQL 基础</h1><p class="note note-info">本文最后更新于：2023年4月18日 晚上</p><div class="markdown-body"><h1 id="explain解析"><a href="#explain解析" class="headerlink" title="explain解析"></a>explain解析</h1><p>+—-+————-+——-+————+——+—————+——+———+——+——–+———-+——-+<br>| id | <strong>select_type</strong> | table | partitions | <strong>type</strong> | possible_keys | key | key_len | ref | rows | filtered | <strong>Extra</strong> |<br>+—-+————-+——-+————+——+—————+——+———+——+——–+———-+——-+</p><h2 id="1、id"><a href="#1、id" class="headerlink" title="1、id"></a>1、id</h2><p>id用来标识整个查询中SELELCT语句的顺序，在嵌套查询中id越大的语句越先执行，该值可能为NULL</p><p>id如果相同，从上往下依次执行。id不同，id值越大，执行优先级越高，如果行引用其他行的并集结果，则该值可以为NU</p><h2 id="2、select-type"><a href="#2、select-type" class="headerlink" title="2、select_type"></a>2、select_type</h2><p><strong>simple</strong></p><p><strong>primary</strong></p><p><strong>union</strong></p><p><strong>dependent union</strong></p><p><strong>subquery</strong></p><p><strong>dependent subquery</strong></p><p><strong>derived</strong></p><h2 id="3、table"><a href="#3、table" class="headerlink" title="3、table"></a>3、table</h2><p>table用来表示输出行所引用的表名</p><h2 id="4、type（重要）"><a href="#4、type（重要）" class="headerlink" title="4、type（重要）"></a>4、type（重要）</h2><p><strong>system</strong></p><p><strong>const</strong></p><p><strong>eq_ref</strong></p><p><strong>ref</strong></p><p><strong>ref_or_null</strong></p><p><strong>index_merge</strong></p><p><strong>range</strong></p><p><strong>index</strong></p><p><strong>all</strong></p><h2 id="6、key（重要）"><a href="#6、key（重要）" class="headerlink" title="6、key（重要）"></a>6、key（重要）</h2><p>key列显示的是当前表实际使用的索引，如果没有选择索引，则此列为null，要想强制MySQL使用或忽视possible_keys列中的索引，在查询中使用FORCE INDEX、USE INDEX或者IGNORE INDEX</p><h2 id="7、key-len"><a href="#7、key-len" class="headerlink" title="7、key_len"></a>7、key_len</h2><p>key_len列显示MySQL决定使用的键长度。如果KEY键是NULL，则长度为NULL。<strong>在不损失精确性的情况下，长度越短越好</strong></p><p>key len的长度还和字符集有关,latin1一个字符占用1个字节,gbk一个字符占用2个字节,utf8一个字符占用3个字节。key_len的计算法方法：</p><h2 id="8、ref"><a href="#8、ref" class="headerlink" title="8、ref"></a>8、ref</h2><p>ref列用来显示使用哪个列或常数与key一起从表中选择相应的行。它显示的列的名字（或const），此列多数时候为null</p><h2 id="9、rows"><a href="#9、rows" class="headerlink" title="9、rows"></a>9、rows</h2><p>rows列显示的是mysql解析器认为执行此SQL时必须扫描的行数。此数值为一个预估值，不是具体值，通常比实际值小</p><h2 id="10、filtered"><a href="#10、filtered" class="headerlink" title="10、filtered"></a>10、filtered</h2><p>此参数为<strong>mysql 5.7 新加参数</strong>，指的是返回结果的行数所占需要读到的行（rows的值）的比例 对于使用join时，前一个表的结果集大小直接影响了循环的行数</p><h2 id="11、extra（重要）"><a href="#11、extra（重要）" class="headerlink" title="11、extra（重要）"></a>11、extra（重要）</h2><p><strong>using index</strong></p><p><strong>using where</strong></p><p><strong>using temporary</strong></p><p><strong>using filesort</strong></p><p><strong>using join buffer</strong></p><p><strong>impossible where</strong></p><p><strong>using index condition</strong></p><h1 id="varchar（100）可以存多少中文字符"><a href="#varchar（100）可以存多少中文字符" class="headerlink" title="varchar（100）可以存多少中文字符"></a>varchar（100）可以存多少中文字符</h1><p>4.0版本以下，varchar(100)，指的是100字节，如果存放UTF8汉字时，只能存33个（每个汉字3字节）</p><p>5.0版本以上，varchar(100)，指的是100字符，无论存放的是数字、字母还是UTF8汉字（每个汉字3字节），都可以存放100个。                      </p><h1 id="常用数字类型图"><a href="#常用数字类型图" class="headerlink" title="常用数字类型图"></a>常用数字类型图</h1><img src="/posts/47eac6e4/39e54196f2ef05825d5c1acc5a011b9e1603852427033.png" srcset="/img/loading.gif" lazyload alt="常用数字类型图"><h1 id="int、bigint、smallint-和-tinyint的区别"><a href="#int、bigint、smallint-和-tinyint的区别" class="headerlink" title="int、bigint、smallint 和 tinyint的区别"></a>int、bigint、smallint 和 tinyint的区别</h1><blockquote><p>举个栗子：</p><p>int(M) 在 integer 数据类型中，M 表示最大显示宽度。在 int(M) 中，M 的值跟 int(M) 所占多少存储空间并无任何关系。和数字位数也无关系 int(3)、int(4)、int(8) 在磁盘上都是占用 4 btyes 的存储空间。</p></blockquote><h2 id="bigint"><a href="#bigint" class="headerlink" title="bigint"></a>bigint</h2><blockquote><p>bigint已经有长度了，在mysql建表中的length，只是用于显示的位数。</p></blockquote><p>从 -2^63 (-9223372036854775808) 到 2^63-1 (9223372036854775807) 的整型数据（所有数字）。存储大小为 8 个字节。</p><h2 id="int"><a href="#int" class="headerlink" title="int"></a><strong>int</strong></h2><p>从 -2^31 (-2,147,483,648) 到 2^31 – 1 (2,147,483,647) 的整型数据（所有数字）。存储大小为 4 个字节。<strong>int</strong> 的 SQL-92 同义字为 <strong>integer</strong>。</p><h2 id="smallint"><a href="#smallint" class="headerlink" title="smallint"></a><strong>smallint</strong></h2><p>从 -2^15 (-32,768) 到 2^15 – 1 (32,767) 的整型数据。存储大小为 2 个字节。</p><h2 id="tinyint"><a href="#tinyint" class="headerlink" title="tinyint"></a><strong>tinyint</strong></h2><p>从 0 到 255 的整型数据。存储大小为 1 字节。</p><h2 id="显示位数示例"><a href="#显示位数示例" class="headerlink" title="显示位数示例"></a>显示位数示例</h2><blockquote><p>重点在于<strong>ZEROFILL</strong>，可以对显示位数不足的地方进行填充，如果不设置 <strong>ZEROFILL</strong> ，数值类型后面的括号中的数值就是无意义的。</p></blockquote><p>示例：</p><p>先将id的类型更改为int(2)，然后插入数据id&#x3D;1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; ALTER TABLE test Modify id int(2);<br>mysql&gt; INSERT INTO test(id) values(1);//运行成功，说明值1已经插入到test表中<br></code></pre></td></tr></table></figure><p>我们查询一下表中的数据，看看结果具体如何：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test;<br>+------+<br>|  id  |<br>+------+<br>|   1  |<br>+------+<br></code></pre></td></tr></table></figure><p>接下来，我们再修改一下id的填充数据类型zerofill（表示用 0 填充），这里先知道如何操作即可，我们再从结果得出结论：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; ALTER TABLE test MODIFY id int(2) zerofill;<br>mysql&gt; SELECT * FROM test;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">+------+<br>|  id  |<br>+------+<br>|  01  |<br>+------+<br></code></pre></td></tr></table></figure><h1 id="时间存储"><a href="#时间存储" class="headerlink" title="时间存储"></a>时间存储</h1><p>MySQL 数据库中常见的日期类型有 YEAR、DATE、TIME、DATETIME、TIMESTAMEP。因为一般都需要将日期精确到秒，其中比较合适的有DATETIME，TIMESTAMEP。</p><h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><table><thead><tr><th>日期类型</th><th>占用空间（不带毫秒）</th><th>占用空间（带毫秒）</th><th>日期格式</th><th>日期范围</th><th>是否存在时区问题</th></tr></thead><tbody><tr><td>DATETIME</td><td>8字节</td><td>8字节</td><td>YYYY-MM-DD HH:MM:SS</td><td>1000-01-01 00:00:00 - 9999-12-31 23:59:59</td><td>是</td></tr><tr><td>TIMESTAMP</td><td>4字节</td><td>7字节</td><td>YYYY-MM-DD HH:MM:SS</td><td>1970-01-01 00:00:00 - 2038-01-19 03:14:07</td><td>否</td></tr><tr><td>INT</td><td>4字节</td><td>4字节</td><td>全数字时间戳</td><td>1000-01-01 00:00:01 之后的时间</td><td>否</td></tr></tbody></table><h2 id="DATETIME"><a href="#DATETIME" class="headerlink" title="DATETIME"></a><strong>DATETIME</strong></h2><blockquote><p>从 MySQL 5.6 版本开始，DATETIME 类型支持毫秒，DATETIME(N) 中的 N 表示毫秒的精度。例如，DATETIME(6) 表示可以存储 6 位的毫秒值。</p></blockquote><p>DATETIME 在数据库中存储的形式为：YYYY-MM-DD HH:MM:SS，固定占用 <strong>8</strong> 个字节。</p><h2 id="TIMESTAMP"><a href="#TIMESTAMP" class="headerlink" title="TIMESTAMP"></a><strong>TIMESTAMP</strong></h2><blockquote><p>从 MySQL 5.6 版本开始，类型 TIMESTAMP 也能支持毫秒。与 DATETIME 不同的是，若带有毫秒时，类型 TIMESTAMP 占用 7 个字节，而 DATETIME 无论是否存储毫秒信息，都占用 8 个字节。</p></blockquote><p>TIMESTAMP 实际存储的内容为 1970-01-01 00:00:00 到现在的毫秒数。在 MySQL 中，由于类型 TIMESTAMP 占用 <strong>4</strong> 个字节，因此其存储的时间上限只能到 2038-01-19 03:14:07。</p><p>类型 TIMESTAMP 最大的优点是可以带有时区属性，因为它本质上是从毫秒转化而来。Timestamp 类型字段的值会随着服务器时区的变化而变化，自动换算成相应的时间，说简单点就是在不同时区，查询到同一个条记录此字段的值会不一样。</p><h3 id="性能问题"><a href="#性能问题" class="headerlink" title="性能问题"></a>性能问题</h3><p>TIMESTAMP 还存在潜在的性能问题。</p><p>虽然从毫秒数转换到类型 TIMESTAMP 本身需要的 CPU 指令并不多，这并不会带来直接的性能问题。但是如果使用默认的操作系统时区，则每次通过时区计算时间时，要调用操作系统底层系统函数 __tz_convert()，而这个函数需要额外的加锁操作，以确保这时操作系统时区没有修改。所以，当大规模并发访问时，由于热点资源竞争，会产生两个问题：</p><ul><li>性能不如 DATETIME：DATETIME 不存在时区转化问题。</li><li>性能抖动：海量并发时，存在性能抖动问题。</li></ul><p>为了优化 TIMESTAMP 的使用，建议使用显式的时区，而不是操作系统时区。比如在配置文件中显示地设置时区，而不要使用系统时区：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[mysqld]<br><br>time_zone = &quot;+08:00&quot;<br>复制代码<br></code></pre></td></tr></table></figure><p>简单总结一下这两种数据类型的优缺点：</p><ul><li>DATETIME 没有存储的时间上限，而 TIMESTAMP 存储的时间上限只能到 2038-01-19 03:14:07</li><li>DATETIME 不带时区属性，需要前端或者服务端处理，但是仅从数据库保存数据和读取数据而言，性能更好</li><li>TIMESTAMP 带有时区属性，但是每次需要通过时区计算时间，并发访问时会有性能问题</li><li>存储 DATETIME 比 TIMESTAMP 多占用一部分空间</li></ul><h2 id="数值型时间戳（INT）"><a href="#数值型时间戳（INT）" class="headerlink" title="数值型时间戳（INT）"></a><strong><del>数值型时间戳</del>（INT）</strong></h2><p>很多时候，我们也会使用 int 或者 bigint 类型的数值也就是时间戳来表示时间。</p><p>这种存储方式的具有 Timestamp 类型的所具有一些优点，并且使用它的进行日期排序以及对比等操作的效率会更高，跨系统也很方便，毕竟只是存放的数值。缺点也很明显，就是数据的可读性太差了，你无法直观的看到具体时间。</p><p>如果需要查看某个时间段内的数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> created_at <span class="hljs-operator">&gt;</span> UNIX_TIMESTAMP(<span class="hljs-string">&#x27;2021-01-01 00:00:00&#x27;</span>);<br></code></pre></td></tr></table></figure><p>不推荐使用 ，理由如下：</p><img src="/posts/47eac6e4/d859318270b849fea74d1a307aea246ftplv-k3u1fbpfcp-zoom-1.image" srcset="/img/loading.gif" lazyload alt="img"><h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a><del>字符串</del></h2><p>极力不推荐，原因如下：</p><ul><li>字符串占用的空间大</li><li>这样存储的字段比较效率太低，只能逐个字符比较，无法使用 MySQL 提供的日期API</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>个人推荐 DATETIME，理由如下：</p><ul><li>TIMESTAMP 比数值型时间戳可读性更好</li><li>DATETIME 的存储上限为 9999-12-31 23:59:59，如果使用 TIMESTAMP，则 2038 年需要考虑解决方案</li><li>DATETIME 由于不需要时区转换，所以性能比 TIMESTAMP 好</li><li>如果需要将时间存储到毫秒，TIMESTAMP 要 7 个字节，和 DATETIME 8 字节差不太多</li></ul><h1 id="时区"><a href="#时区" class="headerlink" title="时区"></a>时区</h1><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>名为 CST 的时区是一个很混乱的时区，在与 MySQL 协商会话时区时，Java 会误以为是 <code>CST -0500</code>，而非 <code>CST +0800</code>。</p><h2 id="CST-时区"><a href="#CST-时区" class="headerlink" title="CST 时区"></a>CST 时区</h2><p>名为 CST 的时区是一个很混乱的时区，有四种含义：</p><ul><li>美国中部时间 Central Standard Time (USA) UTC-06:00</li><li>澳大利亚中部时间 Central Standard Time (Australia) UTC+09:30</li><li>中国标准时 China Standard Time UTC+08:00</li><li>古巴标准时 Cuba Standard Time UTC-04:00</li></ul><p>今天是“4月28日”。为什么提到日期？因为美国从“3月11日”至“11月7日”实行夏令时，美国中部时间改为 UTC-05:00，与 UTC+08:00 相差 13 小时。</p><p>当 MySQL 的 <code>time_zone</code> 值为 <code>SYSTEM</code> 时，会取 <code>system_time_zone</code> 值作为协调时区。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show variables like &#x27;%time_zone%&#x27;;<br>+------------------+--------+<br>| Variable_name    | Value  |<br>+------------------+--------+<br>| system_time_zone | CST    |<br>| time_zone        | SYSTEM |<br>+------------------+--------+<br>2 rows in set (0.03 sec)<br></code></pre></td></tr></table></figure><p>这样子会导致以下一系列转换问题：</p><ol><li>JDBC 误认为会话时区在 CST-5</li><li>JBDC 把 Timestamp+0 转为 CST-5 的 String-5</li><li>MySQL 认为会话时区在 CST+8，将 String-5 转为 Timestamp-13，最终导致时间相差13个小时</li></ol><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>明确指定 MySQL 数据库的时区，不使用引发误解的 <code>CST</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; set global time_zone = &#x27;+08:00&#x27;;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; set time_zone = &#x27;+08:00&#x27;;<br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure><p>或者修改 <code>my.cnf</code> 文件，在 <code>[mysqld]</code> 下增加 <code>default-time-zone = &#39;+08:00&#39;</code>。</p><h2 id="Docker启动时设定时区"><a href="#Docker启动时设定时区" class="headerlink" title="Docker启动时设定时区"></a><del>Docker启动时设定时区</del></h2><p>你可以在docker启动的时候设定MySQL容器的时区，比如这样<code>-e TZ=Asia/Shanghai</code>。</p><p>这个方法有问题，会出现时间错乱，workaround是root用户连接到MySQL，然后执行<code>SET GLOBAL time_zone = &#39;Asia/Shanghai&#39;;</code>。</p><p>这样客户端连接MySQL时，查询的时间的时区都是<code>Asia/Shanghai</code>了。</p><h2 id="JAVA获取时区"><a href="#JAVA获取时区" class="headerlink" title="JAVA获取时区"></a>JAVA获取时区</h2><blockquote><p><code>FastDateFormat</code>是<code>org.apache.commons.lang3.time</code>的工具类</p></blockquote><p>只获取时区，如 <code>+8:00</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">FastDateFormat.getInstance(<span class="hljs-string">&quot;&#x27;&#x27;ZZ&#x27;&#x27;&quot;</span>).format(date).replaceAll(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><p>获取完整时间格式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">// 传入时间</span><br>    <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>    <span class="hljs-comment">// 获取当前服务器TimeZone</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">timeZoneId</span> <span class="hljs-operator">=</span> TimeZone.getDefault().getID();<br>    <span class="hljs-comment">// 抓取城市名称</span><br>    String[] arr = timeZoneId.split(<span class="hljs-string">&quot;/&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">city</span> <span class="hljs-operator">=</span> arr.length &gt; <span class="hljs-number">1</span> ? arr[<span class="hljs-number">1</span>] : timeZoneId;<br>    <span class="hljs-comment">// 格式化时间</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">dateStr</span> <span class="hljs-operator">=</span> FastDateFormat.getInstance(<span class="hljs-string">&quot;dd/MM/yyyy HH:mm &#x27;(UTC&#x27;ZZ&#x27;)&#x27;&quot;</span>).format(date) + <span class="hljs-string">&quot; &quot;</span> + city;<br>    System.out.println(dateStr);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><ul><li><code>DATE</code>和<code>TIME</code>类型不支持时区转换。</li><li>对于<code>TIMESTAMP</code>类型，MySQL会正确的根据connection时区（对于JDBC来说就是JVM时区）&#x2F;服务端时区做转换。<ul><li>JDBC程序不需要特别注意什么事情。只要保证JVM时区和用户所在时区保持一致即可。</li></ul></li><li>不要在服务器端做日期时间的字符串格式化<code>DATE_FORMAT()</code>，因为返回的结果是服务端的时区，而不是connection的时区（对于JDBC来说就是JVM时区）。</li><li><code>CURRENT_TIMESTAMP()</code>, <code>CURRENT_TIME()</code>, <code>CURRENT_DATE()</code>可以安全的使用，返回的结果会转换成connection时区（对于JDBC来说就是JVM时区）。</li></ul><h1 id="唯一索引不区分大小写"><a href="#唯一索引不区分大小写" class="headerlink" title="唯一索引不区分大小写"></a>唯一索引不区分大小写</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- 加唯一索引，binary是为了英文区分大小写，因为mysql的唯一索引不区分大小写<br>company_name VARCHAR(100) binary NOT NULL unique COMMENT &#x27;公司名称&#x27;<br></code></pre></td></tr></table></figure><h1 id="唯一索引默认是-btree-还是-hash"><a href="#唯一索引默认是-btree-还是-hash" class="headerlink" title="唯一索引默认是 btree 还是 hash"></a>唯一索引默认是 btree 还是 hash</h1><p>参考链接：<a target="_blank" rel="noopener" href="https://link.segmentfault.com/?url=https://dev.mysql.com/doc/refman/5.7/en/create-index.html%23create-index-storage-engine-index-types">Index Types Per Storage Engine</a></p><ul><li>InnoDB 和 MyISAM 只支持 BTREE，因此默认均是 BTREE。</li><li>MEMORY 和 HEAP 支持 HASH和 BTREE，如无明确声明，则默认索引均是 HASH（包括主键）。</li></ul><h1 id="索引-btree-和-hash-的区别"><a href="#索引-btree-和-hash-的区别" class="headerlink" title="索引 btree 和 hash 的区别"></a>索引 btree 和 hash 的区别</h1><h2 id="hash-索引缺陷"><a href="#hash-索引缺陷" class="headerlink" title="hash 索引缺陷"></a>hash 索引缺陷</h2><ul><li><p><strong>Hash 索引仅仅能满足”&#x3D;”,”IN”和”&lt;&#x3D;&gt;”查询，不能使用范围查询。</strong></p><p>由于 Hash 索引比较的是进行 Hash 运算之后的 Hash 值，所以它只能用于等值的过滤，不能用于基于范围的过滤，因为经过相应的 Hash 算法处理之后的 Hash 值的大小关系，并不能保证和Hash运算前完全一样。</p></li><li><p><strong>Hash 索引无法被用来数据的排序操作。</strong></p><p>由于 Hash 索引中存放的是经过 Hash 计算之后的 Hash 值，而且Hash值的大小关系并不一定和 Hash 运算前的键值完全一样，所以数据库无法利用索引的数据来避免任何排序运算；</p></li><li><p><strong>Hash 索引不能利用部分索引键查询，即不适用最左前缀原则。</strong></p><p>对于组合索引，Hash 索引在计算 Hash 值的时候是组合索引键合并后再一起计算 Hash 值，而不是单独计算 Hash 值，所以通过组合索引的前面一个或几个索引键进行查询的时候，Hash 索引也无法被利用。</p></li><li><p><strong>Hash 索引在任何时候都不能避免表扫描，不可使用覆盖索引。</strong></p><p>前面已经知道，Hash 索引是将索引键通过 Hash 运算之后，将 Hash 运算结果的 Hash 值和所对应的行指针信息存放于一个 Hash 表中，由于不同索引键存在相同 Hash 值，所以即使取满足某个 Hash 键值的数据的记录条数，也无法从 Hash 索引中直接完成查询，还是要通过访问表中的实际数据进行相应的比较，并得到相应的结果。</p></li></ul><h1 id="MySQL运算符之-lt-x3D-gt"><a href="#MySQL运算符之-lt-x3D-gt" class="headerlink" title="MySQL运算符之 &lt;&#x3D;&gt;"></a>MySQL运算符之 &lt;&#x3D;&gt;</h1><p>除了 <code>&lt;=&gt;</code> ，还有两个其他的操作符用来处理某个值和NULL做比较，也就是<code>IS NULL</code> and <code>IS NOT NULL</code>。他们是ANSI标准中的一部分，因此也可以用在其他数据库中。而<code>&lt;=&gt;</code>只能在mysql中使用。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">&#x27;a&#x27; IS NULL     ==&gt; &#x27;a&#x27; &lt;=&gt; NULL<br><br>&#x27;a&#x27; IS NOT NULL ==&gt; NOT(&#x27;a&#x27; &lt;=&gt; NULL)<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="category-chain-item">中间件</a> <span>></span> <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/" class="category-chain-item">MySQL</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/MySQL/">#MySQL</a></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/posts/4a49b547/" title="黑苹果常用配置"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">黑苹果常用配置</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/f4e001d9/" title="JDK 安装（Linux）"><span class="hidden-mobile">JDK 安装（Linux）</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"></div></footer><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>