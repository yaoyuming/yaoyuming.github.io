<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Yahya"><meta name="keywords" content=""><meta name="description" content="redis线程模型 单线程，NIO，异步事件处理    rabbitmq集群架构   rabbitmq引入的问题好处：异步、解耦、削峰 坏处： 重复消息（幂等性保障）  设置唯一消息主键 redis setnx 命令（redis分布式锁）  消息丢失  备份交换机 死信队列 mandantory &#x3D; true + ReturnListener 保证消息不丢失  消息积压  增加消费者的消"><meta property="og:type" content="article"><meta property="og:title" content="面试题"><meta property="og:url" content="https://blog.yahyav2rayssr.top/posts/5205ee75/index.html"><meta property="og:site_name" content="yahya的博客"><meta property="og:description" content="redis线程模型 单线程，NIO，异步事件处理    rabbitmq集群架构   rabbitmq引入的问题好处：异步、解耦、削峰 坏处： 重复消息（幂等性保障）  设置唯一消息主键 redis setnx 命令（redis分布式锁）  消息丢失  备份交换机 死信队列 mandantory &#x3D; true + ReturnListener 保证消息不丢失  消息积压  增加消费者的消"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/5205ee75/image-20200829103120144.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/5205ee75/208.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/5205ee75/209.png"><meta property="og:image" content="https://blog.yahyav2rayssr.top/posts/5205ee75/210.png"><meta property="article:published_time" content="2023-04-18T15:31:24.082Z"><meta property="article:modified_time" content="2023-04-18T15:31:24.083Z"><meta property="article:author" content="Yahya"><meta property="article:tag" content="面试"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://blog.yahyav2rayssr.top/posts/5205ee75/image-20200829103120144.png"><title>面试题 - yahya的博客</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"blog.yahyav2rayssr.top",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!1,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!1,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:6},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="yahya的博客" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Yahya的博客</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="面试题"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-04-18 23:31" pubdate>2023年4月18日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.5k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 21 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="面试" id="heading-1573c74e227f14ded2daa71bb049ecda" role="tab" data-toggle="collapse" href="#collapse-1573c74e227f14ded2daa71bb049ecda" aria-expanded="true">面试 <span class="list-group-count">(9)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-1573c74e227f14ded2daa71bb049ecda" role="tabpanel" aria-labelledby="heading-1573c74e227f14ded2daa71bb049ecda"><div class="category-post-list"><a href="/posts/2e4af39/" title="mybatis 面试题" class="list-group-item list-group-item-action"><span class="category-post">mybatis 面试题</span> </a><a href="/posts/34945828/" title="mysql 面试题" class="list-group-item list-group-item-action"><span class="category-post">mysql 面试题</span> </a><a href="/posts/217b8ff8/" title="rabbitmq 面试题" class="list-group-item list-group-item-action"><span class="category-post">rabbitmq 面试题</span> </a><a href="/posts/9657a236/" title="redis 面试题" class="list-group-item list-group-item-action"><span class="category-post">redis 面试题</span> </a><a href="/posts/238ae934/" title="spring cloud 面试题" class="list-group-item list-group-item-action"><span class="category-post">spring cloud 面试题</span> </a><a href="/posts/3647b27d/" title="zookeeper 面试题" class="list-group-item list-group-item-action"><span class="category-post">zookeeper 面试题</span> </a><a href="/posts/d7158ead/" title="查缺补漏" class="list-group-item list-group-item-action"><span class="category-post">查缺补漏</span> </a><a href="/posts/1f03d757/" title="面试单题" class="list-group-item list-group-item-action"><span class="category-post">面试单题</span> </a><a href="/posts/5205ee75/" title="面试题" class="list-group-item list-group-item-action active"><span class="category-post">面试题</span></a></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">面试题</h1><p class="note note-info">本文最后更新于：2023年4月18日 晚上</p><div class="markdown-body"><h2 id="redis线程模型"><a href="#redis线程模型" class="headerlink" title="redis线程模型"></a>redis线程模型</h2><blockquote><p>单线程，NIO，异步事件处理</p></blockquote><img src="/posts/5205ee75/image-20200829103120144.png" srcset="/img/loading.gif" lazyload alt="image-20200829103120144"><p>rabbitmq集群架构</p><img src="/posts/5205ee75/208.png" srcset="/img/loading.gif" lazyload alt="image-20200829112808080"><h2 id="rabbitmq引入的问题"><a href="#rabbitmq引入的问题" class="headerlink" title="rabbitmq引入的问题"></a>rabbitmq引入的问题</h2><p>好处：异步、解耦、削峰</p><p>坏处：</p><p>重复消息（幂等性保障）</p><ul><li>设置唯一消息主键</li><li>redis setnx 命令（redis分布式锁）</li></ul><p>消息丢失</p><ul><li>备份交换机</li><li>死信队列</li><li>mandantory &#x3D; true + ReturnListener 保证消息不丢失</li></ul><p>消息积压</p><ul><li>增加消费者的消费能力，或者临时增加</li></ul><p>顺序消费怎么解决</p><ul><li>单一消费者</li></ul><h2 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h2><p>zookeeper分布式锁</p><p>监听回调、临时节点</p><h1 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h1><blockquote><p>如果超时就会出现分布式事务问题。</p></blockquote><h2 id="二阶段提交"><a href="#二阶段提交" class="headerlink" title="二阶段提交"></a>二阶段提交</h2><p>atomikos框架实现二阶段提交，可以做到重试机制，日志记录等逻辑，但是无法解决微服务中跨JVM的问题。</p><h2 id="可靠消息最终一致性方案"><a href="#可靠消息最终一致性方案" class="headerlink" title="可靠消息最终一致性方案"></a>可靠消息最终一致性方案</h2><p>可以通过自定义一个消息信息体Message，给消息设置INIT，SEND，END三种状态，然后搭建一个独立的消息服务来补偿消息发送过程可能出现异常的问题，或者是因为网络超时导致消息状态没有修改成功，定时的调用业务系统的相关接口，比如订单是否成功生成，库存是否成功减掉来修复消息本身的状态，进而对操作消息的下一步执行过程。</p><ul><li><p>TCC与XA&#x2F;JTA对比</p><ul><li>XA是资源层面的分布式事务，强一致性，在两阶段提交的整个过程中，一直会持有资源的锁</li><li>TCC是业务层面的分布式事务，最终一致性，不会一直持有资源的锁</li></ul></li><li><p>TCC的开源框架实现</p><p>Atomikos，tcc-transaction，ByteTcc，支付宝GTS</p></li></ul><h2 id="可靠消息最终一致性方案-1"><a href="#可靠消息最终一致性方案-1" class="headerlink" title="可靠消息最终一致性方案"></a><strong>可靠消息最终一致性方案</strong></h2><img src="/posts/5205ee75/209.png" srcset="/img/loading.gif" lazyload alt="image-20200831170506773"><h2 id="TCC-Try-Confirm-Cancel-两阶段补偿型方案"><a href="#TCC-Try-Confirm-Cancel-两阶段补偿型方案" class="headerlink" title="TCC(Try-Confirm-Cancel)两阶段补偿型方案"></a>TCC(Try-Confirm-Cancel)两阶段补偿型方案</h2><img src="/posts/5205ee75/210.png" srcset="/img/loading.gif" lazyload alt="image-20200831220121891"><h1 id="秒杀系统"><a href="#秒杀系统" class="headerlink" title="秒杀系统"></a>秒杀系统</h1><p>spring session实现分布式session</p><p>zookeeper节点通过watcher机制保证本地ConcurrentHashMap中的当前商品库存数量一致，防止超卖问题</p><p>redis setnx分布式锁保证接口多次请求只有一次能成功，类似于占位标识，一个用户只能有一个订单的请求，搭配rabbitmq中间件异步消费订单消息，消费成功后解除占位标识，同时在redis中生成订单信息</p><p>通过redis的incr实现限流防刷</p><p>详情页优化使用动态化渲染，用nginx+lua实现页面动态化，nginx层面做了两层，一层通过hash取模实现负载转发，一层用于缓存热点数据以减少redis缓存的压力</p><ul><li><p>缓存失效</p><p>由于大量的key设置相同的过期时间导致，可以采用随机数来设置过期时间避免大量缓存同一时间失效。</p></li><li><p>缓存击穿</p><p>打个比方，某个黑客想要攻击网站，那么他通过URL访问一个不存在的商品来跳过nginx的本地缓存，web应用里面的ecache缓存和redis缓存来直接访问数据库，造成数据库压力暴涨导致系统直接宕机；这个可以通过在redis里面设置某个商品的键值对为&lt;key ,null&gt;来避免直接访问数据库，如果查询到一个值为null的key，直接返回商品不存在的提示信息。</p></li><li><p>缓存雪崩</p><p>缓存雪崩是因为大量的并发请求流入，超过了服务器的负载能力，直接压爆了nginx缓存和redis缓存以及各种缓存从而直接导致系统瘫痪，本质上没法根本解决，为了避免缓存雪崩可以通过水平扩展nginx机器增加nginx缓存或者增加redis cluster内的机器，响应更多的并发请求。</p></li></ul><h1 id="计算机所能处理的最小的数据项"><a href="#计算机所能处理的最小的数据项" class="headerlink" title="计算机所能处理的最小的数据项"></a>计算机所能处理的最小的数据项</h1><p>位。</p><h1 id="优化Hibernate所鼓励的7大措施："><a href="#优化Hibernate所鼓励的7大措施：" class="headerlink" title="优化Hibernate所鼓励的7大措施："></a>优化Hibernate所鼓励的7大措施：</h1><ol><li><p>尽量使用many-to-one，避免使用单项one-to-many</p></li><li><p>灵活使用单向one-to-many</p></li><li><p>不用一对一，使用多对一代替一对一</p></li><li><p>配置对象缓存，不使用集合缓存</p></li><li><p>一对多使用Bag 多对一使用Set</p></li><li><p>继承使用显示多态 HQL:from object polymorphism&#x3D;”exlicit” 避免查处所有对象</p></li><li><p>消除大表，使用二级缓存</p></li></ol><h1 id="JSP内置对象"><a href="#JSP内置对象" class="headerlink" title="JSP内置对象"></a>JSP内置对象</h1><p>一共有9个内置对象</p><ul><li>pageContext javax.servlet.jsp.PageContext</li><li>request javax.servlet.http.HttpServletRequest</li><li>response javax.servlet.http.HttpServletResponse</li><li>session javax.servlet.http.HttpSession</li><li>application javax.servlet.ServletContext</li><li>config javax.serlvet.ServletConfig</li><li>exception java.lang.Throwable</li><li>page java.lang.Object</li><li>out javax.servlet.jsp.JspWriter</li></ul><p>作用：</p><ol><li><p>pageContext 表示页容器 EL表达式、 标签 、上传</p></li><li><p>request 服务器端取得客户端的信息：头信息 、Cookie 、请求参数 ，最大用处在MVC设计模式上</p></li><li><p>response 服务器端回应客户端信息：Cookie、重定向</p></li><li><p>session 表示每一个用户，用于登录验证上</p></li><li><p>application 表示整个服务器</p></li><li><p>config 取得初始化参数，初始化参数在web.xml文件中配置</p></li><li><p>exception 表示的是错误页的处理操作</p></li><li><p>page 如同 this 一样，代表整个 jsp 页面自身</p></li><li><p>out 输出，但是尽量使用表达式输出</p></li></ol><h1 id="怎样使JAVA栈内存快速溢出？"><a href="#怎样使JAVA栈内存快速溢出？" class="headerlink" title="怎样使JAVA栈内存快速溢出？"></a>怎样使JAVA栈内存快速溢出？</h1><p>方法区和堆所有线程共享。虚拟机栈和本地方法栈和程序计数器每个线程独享。 每个线程的栈大小可以通过 参数 ：-Xss512k 来决定每新启动一个线程分配的栈大小。</p><p>如果方法迭代度过深就会出现栈内存溢出。 每一个方法在执行的同时会创建一个栈帧（用来存储局部变量，操作数栈，动态链接，动态出口等信息。）从调用到执行完成的过程就对应着</p><p>一个栈帧在虚拟机中入栈到出栈的过程。（方法执行完成后会释放所有的局部变量）</p><p>堆内存则是绝大部分用来存储生成的对象。 创建对象过多或强引用使GC无法回收则会报堆内存不足的异常。 （GC主要关注区域）</p><p>方法区\元空间\永久代 : 用来存储被虚拟机加载的类信息，常量，静态变量。（jdk8取消了这部分内存区域，一部分放入heap中）</p><p>运行时常量池： 用来存储编译器生成的各种字面量和符号引用。 字面量（new String(“你好”） 你好就是字面量</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E9%9D%A2%E8%AF%95/" class="category-chain-item">面试</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E9%9D%A2%E8%AF%95/">#面试</a></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/posts/c24675b4/" title="MySQL 索引"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">MySQL 索引</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/0/"><span class="hidden-mobile"></span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"></div></footer><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>